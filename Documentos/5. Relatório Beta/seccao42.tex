\section{Servidor}\label{sec42}

A \gls{api-web} é a interface exposta pelo servidor \textit{web} baseado em \acrfull{http} \cite{RFC7231:http}. Esta disponibiliza informação e funcionalidades fornecidas pelo sistema Smart Stocks, através de \textit{endpoints} públicos.

A decisão de utilizar a \textit{framework} \textit{Spring} para implementar o servidor deve-se ao facto de ser uma ferramenta \gls{open-source}. E por fornecer uma integração com tecnologias de \textit{back-end}, como a JPA. Por fim, por questões de conhecimento e de experiência anterior com esta \textit{framework}.

O servidor é composto por várias camadas - Acesso a Dados, Lógica de Negócio e \textit{Controllers} - que se apresentam de seguida.

%
% Acesso a Dados
%
\subsection{Acesso a Dados}\label{subsec421}

Uma vez armazenados os dados de forma persistente é indispensável realizar escritas e leituras sobre os mesmos. Para tal, desenvolveu-se a \acrfull{dal}. 

Para implementar esta camada, ponderaram-se duas opções, \gls{jpa} e \gls{jdbctemplate}. Apesar de \acrshort{jdbctemplate} permitir um maior controlo do lado do programador, não se fizeram notar discrepâncias significativas, pelo que se optou então por \acrshort{jpa}, por questões de familiaridade.

Como o modelo de dados é relativamente extenso o uso de \acrshort{jpa} torna-se benéfico uma vez que permite reduzir a repetição de código envolvido para suportar as operações básicas de \acrfull{crud} em todas as entidades. 

O principal requisito é o acesso aos dados da \acrshort{bd} e o suporte para as operações \acrshort{crud} nas tabelas. Desta forma criou-se interfaces \textit{repositories} com métodos que garantem não só essas operações, como outras para facilitar a obtenção de dados de determinada forma. O uso de \acrshort{jpa} obriga a representar o modelo da \acrshort{bd} em classes \textit{Java}, \acrfull{pojo}.

\subsubsection{Implementação}\label{subsubsec4211}

No acesso a dados, são utilizados dois padrões de desenho: Padrão \textit{Repository} e Padrão \textit{Unit Of Work}. Esta componente é, salvo exceções, gerada através da \acrshort{jpa}.

Cada entidade presente na \acrshort{bd} é mapeada numa classe em Java, que representa o modelo da mesma. Esta classe tem várias anotações da JPA para referir a \acrlong{cp}, \acrlong{ce}, associações entre entidades, etc. Em conjunto estas classes Java formam o modelo utilizado entre as camadas internas do lado do servidor.

%
% Lógica de Negócio
%
\subsection{Lógica de Negócio}\label{subsec422}

É fundamental fazer cumprir as regras, restrições e toda a lógica da gestão dos dados para o correto funcionamento do sistema. Assim  este controlo foi depositado na \acrfull{bll} e também no modelo desenvolvido. Esta decisão permite não só concentrar a gestão dos dados como também controlar numa camada intermédia os dados a obter, atualizar, remover ou inserir, antes de realizar o acesso/escrita dos mesmos. 

\subsubsection{Implementação}\label{subsubsec4221}

Para a implementação desta camada criaram-se diversos serviços. Estes expõem funcionalidades e aplicam as regras de negócio necessárias. É de salientar que um serviço está fortemente ligado a um ou mais \textit{repositories}.

%
% Controllers
%
\subsection{\textit{Controllers}}\label{subsec423}

Os \textit{controllers} são responsáveis por processar os \textit{endpoints} e produzir uma resposta. Os formatos de resposta são de três tipos, \textit{Json Home}, \textit{Siren} e \textit{Problem Details}. A escolha destas \textit{hypermedias} apoia-se em questões evolutivas da API em termos de hiperligações, ou seja, caso os \textit{endpoints} dos recursos sejam alterados a aplicação cliente não sofre alterações.

%
% Segurança
%
\subsection{Segurança}\label{subsec424}

Sendo o Smart Stocks um sistema de gestão de stocks domésticos é de extrema importância assegurar a confidencialidade e segurança dos dados de cada casa. Como tal, o acesso a recursos ou a manipulação dos mesmos só pode suceder de forma autenticada e autorizada. Ao assumir a utilização do protocolo \acrfull{https} \cite{RFC2660:https}, nesta primeira fase, permitiu escolher como forma de autenticação o \textit{Basic Scheme} \cite{RFC7617:basicSheme} .


